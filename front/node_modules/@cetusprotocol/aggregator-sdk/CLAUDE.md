# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

The **Cetus Aggregator SDK** is a TypeScript library for the Sui blockchain ecosystem that provides swap aggregation across 25+ decentralized exchanges (DEXs). The SDK finds optimal trading routes, best prices, and lowest slippage by integrating multiple DEXs including Cetus, DeepBook, Kriya, FlowX, Turbos, Aftermath, and many others.

## Development Commands

### Build and Development

- `bun run build` - Compile TypeScript to CommonJS/ESM with type definitions using tsup
- `bun run dev` - Development mode with file watching
- `bun run clean` - Remove build artifacts and dependencies
- `bun run publish:test` - Publish experimental version to bun

### Testing

- `bun test` - Run Jest test suite with ESM support
- Tests are organized by aggregator versions (v2/v3) in `/tests/` directory
- Individual DEX tests located in `/tests/aggregatorv2/router/`
- Mathematical function tests in `/tests/math.test.ts`

## Architecture

### Core Components

**Main Entry Points:**

- `src/index.ts` - Main export barrel
- `src/client.ts` - Aggregator v2 client implementation
- `src/clientv3.ts` - Aggregator v3 client implementation

**Key Directories:**

- `src/transaction/` - DEX-specific swap implementations (25+ integrations)
- `src/utils/` - Utility functions for coins, transactions, API calls
- `src/types/` - TypeScript type definitions
- `src/movecall/` - Move contract interaction helpers
- `src/api/` - API interaction layer
- `src/math/` - Mathematical calculations for trading

### DEX Integration Pattern

Each DEX has its own transaction module in `src/transaction/` following a consistent pattern:

- Import from main client class (AggregatorClient/AggregatorClient)
- Implement DEX-specific swap logic
- Handle transaction building and execution
- Support both amount-in and amount-out calculations

### TypeScript Configuration

- Uses path mapping: `~/*` maps to `src/*`
- Jest configured with same path mapping
- Targets ES6 with CommonJS modules
- Strict TypeScript enabled

### Key Dependencies

- `@mysten/sui@^1.6.0` - Official Sui SDK for blockchain interactions
- `@pythnetwork/pyth-sui-js@^2.1.0` - Pyth oracle integration for price feeds
- `bn.js@^5.2.1` - Big number handling for precise calculations
- `decimal.js@^10.4.3` - Decimal arithmetic for financial calculations

### Multi-Version Support

The SDK supports both Aggregator v2 and v3 APIs:

- v2: Legacy aggregator with extensive DEX support
- v3: Newer aggregator with enhanced features and performance

### Testing Strategy

- Unit tests for mathematical functions (`tests/math.test.ts`)
- Integration tests for each DEX in `tests/aggregatorv2/router/`
- Router functionality tests (`tests/aggregatorv2/router.test.ts`)
- Wallet interaction tests (`tests/wallet.test.ts`)

### Build Process

Uses `tsup` for bundling with:

- Multiple output formats (CJS, ESM, TypeScript declarations)
- Tree shaking enabled
- Code splitting support
- Development watch mode

### Contract Addresses

The SDK works with multiple contract versions on Sui mainnet:

- CetusAggregatorV2: `0x3864c7c59a4889fec05d1aae4bc9dba5a0e0940594b424fbed44cb3f6ac4c032`
- CetusAggregatorV2ExtendV1: `0x39402d188b7231036e52266ebafad14413b4bf3daea4ac17115989444e6cd516`
- CetusAggregatorV2ExtendV2: `0x368d13376443a8051b22b42a9125f6a3bc836422bb2d9c4a53984b8d6624c326`
- CetusAggregatorSimple: `0x594d67abc0778023ac852800578271dd7e18698ad06e6298034858c77612333d`

### Environment Setup

The SDK works with Sui mainnet and testnet environments via the `Env` enum. Configure clients with appropriate RPC endpoints and package configurations for the target network.
